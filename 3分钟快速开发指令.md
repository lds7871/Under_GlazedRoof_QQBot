# ğŸš€ QQ Bot æŒ‡ä»¤å¿«é€Ÿå¼€å‘æŒ‡å—

å¿«é€Ÿå­¦ä¼šå¦‚ä½•åˆ›å»ºè‡ªå·±çš„ QQ Bot æŒ‡ä»¤

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
2. [å¼€å‘ä¸¤ç§ç±»å‹æŒ‡ä»¤](#2-å¼€å‘ä¸¤ç§ç±»å‹æŒ‡ä»¤)
3. [å®Œæ•´ç¤ºä¾‹](#3-å®Œæ•´ç¤ºä¾‹)
4. [å·¥å…·æ–¹æ³•é€ŸæŸ¥](#4-å·¥å…·æ–¹æ³•é€ŸæŸ¥)
5. [å¸¸è§é”™è¯¯é¿å‘](#5-å¸¸è§é”™è¯¯é¿å‘)

---

## 1. æ¶æ„æ¦‚è§ˆ

### æŒ‡ä»¤ç±»ç³»ç»Ÿ

```
Command (æ¥å£)
    â†‘
    â”‚ å®ç°
    â”‚
BaseCommand (æŠ½è±¡åŸºç±»)
    â”œâ”€ æä¾›éªŒè¯ã€å‚æ•°å¤„ç†å·¥å…·
    â”œâ”€ æ™®é€šæŒ‡ä»¤ç»§æ‰¿è¿™ä¸ª
    â”‚
    â””â”€ TemplateMarkdownCommand (Markdown ä¸“ç”¨)
        â””â”€ Markdown/Ark æŒ‡ä»¤ç»§æ‰¿è¿™ä¸ª
```

### æ ¸å¿ƒæ¥å£ï¼š`Command.java`

```java
public interface Command {
  String getName();              // æŒ‡ä»¤åç§°ï¼ˆå¦‚ "echo"ï¼‰
  String getDescription();       // æŒ‡ä»¤æè¿°ï¼ˆå¦‚ "é‡å¤è¾“å…¥"ï¼‰
  String getUsage();             // ç”¨æ³•è¯´æ˜
  String execute(String[] args) throws Exception;  // æ‰§è¡ŒæŒ‡ä»¤
}
```

### åŸºç±»ï¼š`BaseCommand.java`

æä¾›ä¸‰ä¸ªå·¥å…·æ–¹æ³•ï¼š

| æ–¹æ³• | ç”¨é€” | è¿”å›å€¼ |
|------|------|--------|
| `validateArgs(args, count)` | ç²¾ç¡®å‚æ•°æ•°é‡æ£€æŸ¥ | é”™è¯¯ä¿¡æ¯æˆ– null |
| `validateMinArgs(args, count)` | æœ€å°‘å‚æ•°æ•°é‡æ£€æŸ¥ | é”™è¯¯ä¿¡æ¯æˆ– null |
| `joinArgs(args, startIndex)` | è¿æ¥å‚æ•°ä¸ºå­—ç¬¦ä¸² | è¿æ¥åçš„å­—ç¬¦ä¸² |

---

## 2. å¼€å‘ä¸¤ç§ç±»å‹æŒ‡ä»¤

### ç±»å‹ Aï¼šæ™®é€šæŒ‡ä»¤ï¼ˆçº¯æ–‡æœ¬å›å¤ï¼‰

ç»§æ‰¿ `BaseCommand`ï¼Œè¿”å›çº¯æ–‡æœ¬

#### ä»£ç æ¨¡æ¿

```java
package org.example.commands;

import org.springframework.stereotype.Component;

@Component
public class MyCommand extends BaseCommand {

  @Override
  public String getName() {
    return "mycmd";  // æŒ‡ä»¤åç§°
  }

  @Override
  public String getDescription() {
    return "æˆ‘çš„è‡ªå®šä¹‰æŒ‡ä»¤";  // ç®€çŸ­æè¿°
  }

  @Override
  public String getUsage() {
    return "ç”¨æ³•ï¼š/mycmd [å‚æ•°1] [å‚æ•°2]\nä¾‹å­ï¼š/mycmd hello world";
  }

  @Override
  public String execute(String[] args) {
    // 1ï¸âƒ£ å‚æ•°éªŒè¯
    String validation = validateMinArgs(args, 1);
    if (validation != null) {
      return validation;
    }

    // 2ï¸âƒ£ é€»è¾‘å¤„ç†
    String result = "ä½ è¾“å…¥äº†ï¼š" + joinArgs(args, 0);

    // 3ï¸âƒ£ è¿”å›ç»“æœ
    return result;
  }
}
```

### ç±»å‹ Bï¼šMarkdown æŒ‡ä»¤ï¼ˆå¯Œæ–‡æœ¬/å¡ç‰‡å›å¤ï¼‰ï¼ï¼ï¼æ—¥æ´»æ²¡2000ä¸é…ç”¨

- ç»§æ‰¿ `TemplateMarkdownCommand`ï¼Œè¿”å› JSON æ ¼å¼çš„ Markdown æ¨¡æ¿
- æ³¨æ„ï¼ŒMarkDownéœ€è¦QQå¼€æ”¾å¹³å°å®¡æ ¸å¼€é€šï¼Œå¼€é€šåå†™æ¨¡æ¿è¿˜è¦å®¡æ ¸ï¼Œå®¡æ ¸å®Œæœºå™¨äººæ—¥æ´»æ²¡2000ä¾æ—§ä¸èƒ½ä½¿ç”¨
- è¾“å‡ºæ ¼å¼è¦ä¸ä½ çš„æ¨¡æ¿ç›¸å¯¹åº”

#### ä»£ç æ¨¡æ¿

```java
package org.example.commands;

import org.springframework.stereotype.Component;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

@Component
public class MyMarkdownCommand extends TemplateMarkdownCommand {

  // å¸¸é‡å®šä¹‰
  private static final String TEMPLATE_ID = "ä½ çš„æ¨¡æ¿ID";

  @Override
  public String getName() {
    return "mymd";
  }

  @Override
  public String getDescription() {
    return "æˆ‘çš„ Markdown æŒ‡ä»¤";
  }

  @Override
  public String getUsage() {
    return "ç”¨æ³•ï¼š/mymd [å‚æ•°]";
  }

  // â­ è¿”å›æ¨¡æ¿ ID
  @Override
  protected String getMarkdownTemplateId() {
    return TEMPLATE_ID;
  }

  // â­ è¿”å›æ¨¡æ¿å‚æ•°åˆ—è¡¨
  @Override
  protected List<Map<String, Object>> getMarkdownParams(String[] args) throws Exception {
    List<Map<String, Object>> params = new ArrayList<>();

    // æ„å»ºå‚æ•°é¡¹
    params.add(buildMarkdownParam("title", "æˆ‘çš„æ ‡é¢˜"));
    params.add(buildMarkdownParam("content", "æˆ‘çš„å†…å®¹"));

    return params;
  }
}
```

#### å®é™…ä¾‹å­ï¼šMarkDownTestCommandï¼ˆå›¾ç‰‡æŒ‡ä»¤ï¼‰

```java
@Component
public class MarkDownTestCommand extends TemplateMarkdownCommand {

  private static final String TEMPLATE_ID = "102813362_1760679605";
  private static final String DEFAULT_IMAGE_URL = 
    "https://q.qq.com/qqbot/static/images/f3648b8001dfa331020c096a85057715.png";

  @Override
  public String getName() {
    return "img";
  }

  @Override
  public String getDescription() {
    return "å‘é€å›¾ç‰‡æ¶ˆæ¯ç¤ºä¾‹";
  }

  @Override
  public String getUsage() {
    return "/img [URL] - å¯é€‰æŒ‡å®šå›¾ç‰‡ URL";
  }

  @Override
  protected String getMarkdownTemplateId() {
    return TEMPLATE_ID;  // å®˜æ–¹å›¾ç‰‡æ¨¡æ¿
  }

  @Override
  protected List<Map<String, Object>> getMarkdownParams(String[] args) throws Exception {
    List<Map<String, Object>> params = new ArrayList<>();

    // æå– URLï¼ˆæœ‰å‚æ•°ç”¨å‚æ•°ï¼Œæ— å‚æ•°ç”¨é»˜è®¤ï¼‰
    String imageUrl = (args.length > 0 && args[0].startsWith("http"))
      ? args[0]
      : DEFAULT_IMAGE_URL;

    // åªéœ€è¦ ReturnImg å‚æ•°
    params.add(buildMarkdownParam("ReturnImg", imageUrl));

    return params;
  }
}
```

**è¾“å‡ºæ ¼å¼**ï¼š

```json
{
  "msg_type": 2,
  "markdown": {
    "custom_template_id": "102813362_1760679605",
    "params": [
      {
        "key": "ReturnImg",
        "values": ["https://example.com/image.png"]
      }
    ]
  }
}
```

---

## 3. å·¥å…·æ–¹æ³•é€ŸæŸ¥

### BaseCommand æä¾›çš„æ–¹æ³•

#### 1. å‚æ•°éªŒè¯

```java
// ç²¾ç¡®å‚æ•°æ•°é‡ï¼ˆå¿…é¡»ç­‰äº countï¼‰
String error = validateArgs(args, 2);
if (error != null) return error;

// æœ€å°‘å‚æ•°æ•°é‡ï¼ˆå¿…é¡» >= minCountï¼‰
String error = validateMinArgs(args, 1);
if (error != null) return error;
```

#### 2. å‚æ•°å¤„ç†

```java
// è¿æ¥å‚æ•°ä¸ºå­—ç¬¦ä¸²
String result = joinArgs(args, 0);     // è¿æ¥å…¨éƒ¨
String result = joinArgs(args, 1);     // ä»ç¬¬äºŒä¸ªå¼€å§‹è¿æ¥
```

### TemplateMarkdownCommand æä¾›çš„æ–¹æ³•

#### 1. æ„å»ºå‚æ•°é¡¹

```java
// å•å€¼å‚æ•°
buildMarkdownParam("key", "value")
  â†“
{"key": "key", "values": ["value"]}

// å¤šå€¼å‚æ•°
buildMarkdownParam("key", "val1", "val2", "val3")
  â†“
{"key": "key", "values": ["val1", "val2", "val3"]}
```

#### 2. è‡ªåŠ¨ç”Ÿæˆå®Œæ•´æ¶ˆæ¯

```java
// ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼execute() å·²è‡ªåŠ¨è°ƒç”¨
protected String buildTemplateMarkdownMessage(List<Map<String, Object>> params)
// è¿”å› JSON æ ¼å¼çš„å®Œæ•´æ¶ˆæ¯
```

---


---

## ğŸ¯ å¼€å‘æ¸…å•

æ–°å»ºæŒ‡ä»¤æ—¶çš„æ£€æŸ¥è¡¨ï¼š

- [ ] ç±»åæœ‰æ„ä¹‰ï¼ˆå¦‚ `MyCommand`ï¼‰
- [ ] æ·»åŠ  `@Component` æ³¨è§£
- [ ] ç»§æ‰¿äº†æ­£ç¡®çš„åŸºç±»ï¼ˆ`BaseCommand` æˆ– `TemplateMarkdownCommand`ï¼‰
- [ ] å®ç°äº†æ‰€æœ‰å¿…è¦æ–¹æ³•ï¼ˆ`getName`ã€`getDescription`ã€`getUsage`ã€`execute`ï¼‰
- [ ] `execute()` æ–¹æ³•ç­¾ååŒ…å« `throws Exception`
- [ ] å‚æ•°éªŒè¯ï¼šä½¿ç”¨ `validateArgs()` æˆ– `validateMinArgs()`
- [ ] é”™è¯¯å¤„ç†ï¼šè¿”å›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼Œä¸è¿”å› null
- [ ] æµ‹è¯•ï¼šç¼–è¯‘å¹¶åœ¨ QQ æœºå™¨äººä¸­æµ‹è¯•
- [ ] é‡å¯æœåŠ¡è®© Spring åŠ è½½æ–°æŒ‡ä»¤

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# å¯åŠ¨ Java æœåŠ¡
mvn spring-boot:run

# åœ¨ QQ ä¸­æµ‹è¯•
/help mycmd
/mycmd [å‚æ•°]
```

---

**å®Œæˆï¼ç°åœ¨ä½ å·²ç»æŒæ¡äº†å¦‚ä½•å¼€å‘ QQ Bot æŒ‡ä»¤ ğŸ‰**
